name: 'Heroku-deploy'
on: 
  push:
    branches:
      - main
  pull_request:
    branches:
      - main      
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: maven clean install
        run: |
          mvn clean package
      - name: Deploy to Heroku
        env:
          HEROKU_API_TOKEN: ${{ secrets.HEROKU_API_TOKEN }}
          HEROKU_APP_NAME: ${{ secrets.HEROKU_APP_NAME }}
        if: github.ref == 'refs/heads/main' && job.status == 'success'
        run: |
          git fetch --unshallow
          git remote add heroku https://heroku:$HEROKU_API_TOKEN@git.heroku.com/$HEROKU_APP_NAME.git
          git push heroku HEAD:main -f
      - name: Create reports folder
        run: |
            mkdir ${{ github.workspace }}/reports	  
      - name: Permission
        run: |
            chmod 777 ${{ github.workspace }}/reports
      - name: Robot Framework Tests
        uses: joonvena/robotframework-docker-action@v0.1
        env:
          BROWSER: chrome
          ROBOT_TESTS_DIR: ${{ github.workspace }}/robot_tests/
          ROBOT_REPORTS_DIR: ${{ github.workspace }}/reports/
      - name: Upload test results
        uses: actions/upload-artifact@v1
        if: always()
        with:
            name: reports
            path: ${{ github.workspace }}/reports/	  
